<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />


<meta name="theme-color" content="#3C8DBC">
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="HandheldFriendly" content="True" />


<meta name="description" content="这里是 @printempw 的个人博客，基本上啥都写：开发心得分享，日常吐槽吹逼，偶尔也会写正经文字。欢迎订阅 RSS (ﾟ∀ﾟ)ﾉ" />

  <meta name="keywords" content="Linux," />




<meta name="google-site-verification" content="WUNRfYChNMDduwLOFHG41TsVrre6BOaI7jKshEvtRts" />



<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">


<meta name="generator" content="Hexo" />


<meta name="description" content="听说加了 swap 会有用。。总之试一下又不会怀孕  参考了 Digital Ocean 官方的教程：How To Add Swap on Ubuntu 14.04  Linux 中 Swap（交换分区），类似于Windows的虚拟内存，就是当内存不足的时候，把一部分硬盘空间虚拟成内存使用，从而解决内存容量不足的情况，和Windows的虚拟内存（pagefile.sys）的作用是一样的。   1.">
<meta name="keywords" content="Linux">
<meta property="og:type" content="article">
<meta property="og:title" content="Ubuntu 14.04 添加 swap 交换分区">
<meta property="og:url" content="https://blessing.studio/ubuntu-14-04-add-swap-2/index.html">
<meta property="og:site_name" content="Blessing Studio">
<meta property="og:description" content="听说加了 swap 会有用。。总之试一下又不会怀孕  参考了 Digital Ocean 官方的教程：How To Add Swap on Ubuntu 14.04  Linux 中 Swap（交换分区），类似于Windows的虚拟内存，就是当内存不足的时候，把一部分硬盘空间虚拟成内存使用，从而解决内存容量不足的情况，和Windows的虚拟内存（pagefile.sys）的作用是一样的。   1.">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://img.blessing.studio/images/2015/07/2015-07-11_13-57-54.jpg">
<meta property="og:image" content="https://img.blessing.studio/images/2015/07/2015-07-11_14-06-47.png">
<meta property="og:image" content="https://img.blessing.studio/images/2015/07/2015-07-11_14-12-21.png">
<meta property="og:image" content="https://img.blessing.studio/images/2015/07/2015-07-11_14-14-14.png">
<meta property="og:image" content="https://img.blessing.studio/images/2015/07/2015-07-11_14-18-18.png">
<meta property="og:image" content="https://img.blessing.studio/images/2015/07/2015-07-11_14-19-51.png">
<meta property="og:image" content="https://img.blessing.studio/images/2015/07/2015-07-10_10-57-26.jpg">
<meta property="og:updated_time" content="2015-08-28T16:36:18.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Ubuntu 14.04 添加 swap 交换分区">
<meta name="twitter:description" content="听说加了 swap 会有用。。总之试一下又不会怀孕  参考了 Digital Ocean 官方的教程：How To Add Swap on Ubuntu 14.04  Linux 中 Swap（交换分区），类似于Windows的虚拟内存，就是当内存不足的时候，把一部分硬盘空间虚拟成内存使用，从而解决内存容量不足的情况，和Windows的虚拟内存（pagefile.sys）的作用是一样的。   1.">
<meta name="twitter:image" content="https://img.blessing.studio/images/2015/07/2015-07-11_13-57-54.jpg">
<meta name="twitter:creator" content="@printempw">





  <link rel="alternate" href="/atom.xml" title="Blessing Studio">



  <link rel="canonical" href="https://blessing.studio/ubuntu-14-04-add-swap-2/"/>



<link rel="shortcut icon" href="/images/favicon.ico">
<link rel="icon" sizes="192x192" href="/images/icon.png" />
<link rel="apple-touch-icon" sizes="144x144" href="/images/touch-icon.png" />


<link rel="stylesheet" href="/css/main.css">
<link rel="stylesheet" href="/libs/fancybox/source/jquery.fancybox.css">
<link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">


<link rel="stylesheet" type="text/css" href="https://fonts.css.network/css?family=Alegreya" />
<link rel="stylesheet" type="text/css" href="https://fonts.css.network/css?family=Alegreya+SC" />
<link rel="stylesheet" type="text/css" href="https://fonts.css.network/css?family=Roboto+Slab">
<link rel="stylesheet" type="text/css" href="https://fonts.css.network/css?family=PT+Serif">


    <title>Ubuntu 14.04 添加 swap 交换分区 - Blessing Studio</title>
  </head>

  <body lang="zh-CN">

    <div id="pageframe" class="fw">
      <script type="text/javascript" src="/js/nanobar.js"></script>
<script type="text/javascript">
    /* Initial NanoBar */
    var nanobar = new Nanobar({
        bg: "#BEDBEC",
        target: document.getElementById("pageframe"),
        id: "inb"
    });
</script>


      <div id="top" class="fw clf">
        <div id="header" class="wc center">
  <div class="logo-container left">
    
    <div class="logo left">
      <a href="https://blessing.studio"><img src="/images/logo.png"></a>
    </div>
  </div>

  <div class="social right">
    
    <div class="ico right" id="tg-s"><a href="javascript:void()" class="fa fa-search"></a></div>
    <form role="search" method="get" id="searchform-top" action="https://www.google.com/search">
      <input type="hidden" name="sitesearch" value="https://blessing.studio">
      <input type="text" name="q" id="s-top" placeholder="搜一搜 (ゝω·)☆ " />
    </form>

    
    <div id="toggler" class="right">
      
        
          <div class="ico">
            <a href="https://twitter.com/printempw" target="_blank" title="Twitter" class="fa fa-twitter"></a>
          </div>
        
          <div class="ico">
            <a href="https://github.com/printempw" target="_blank" title="GitHub" class="fa fa-github"></a>
          </div>
        
      
      <div class="ico">
        <a href="/atom.xml" target="_blank" class="fa fa-rss" ></a>
      </div>
    </div>

    <div class="ico right" id="tg-m"><a href="javascript:;" class="fa fa-bars"></a></div>
  </div>

  <div class="topmenu left">
    <div class="menu-container">
      <ul class="menu">
  
    
    <li class="menu-item menu-item-tech">
      <a href="/categories/tech/" title="提高姿势水平" rel="section">
      技术
      </a>
    </li>
  
    
    <li class="menu-item menu-item-archive">
      <a href="/archives/" title="总览历史文章" rel="section">
      归档
      </a>
    </li>
  
    
    <li class="menu-item menu-item-kaomoji">
      <a href="javascript:void;" title="点我点我" rel="section">
      (´・ω・`)
      </a>
    </li>
  
</ul>

    </div>
  </div>
  <div class="left clf"></div>

</div>

      </div>

      <div id="container" class="wc center clf page-post">
        <script type="text/javascript">nanobar.go(20);</script>

        <div id="content" class="wp">
          

  
  <article class="post post-type-normal hentry">
    <h1 class="post-title">
      <a href="/ubuntu-14-04-add-swap-2/">Ubuntu 14.04 添加 swap 交换分区</a>
    </h1>

    


  <div class="alert alert-warning expired-warning">
    <p>本文最后更新于 767 天前（2015-08-29），其中的信息可能已经有所发展或是发生改变。</p>
  </div>



    <div class="post-content">
      <p>听说加了 swap 会有用。。总之试一下又不会怀孕 <a href="https://img.blessing.studio/images/2015/07/2015-07-11_13-57-54.jpg" target="_blank" rel="external"><img src="https://img.blessing.studio/images/2015/07/2015-07-11_13-57-54.jpg" alt="20150711215742"></a></p>
<p>参考了 Digital Ocean 官方的教程：<a href="https://www.digitalocean.com/community/tutorials/how-to-add-swap-on-ubuntu-14-04" target="_blank" rel="external">How To Add Swap on Ubuntu 14.04</a></p>
<blockquote>
<p>Linux 中 Swap（交换分区），类似于Windows的虚拟内存，就是当内存不足的时候，把一部分硬盘空间虚拟成内存使用，从而解决内存容量不足的情况，和Windows的虚拟内存（pagefile.sys）的作用是一样的。</p>
</blockquote>
<hr>
<h3 id="1-查看操作系统中是否已经有交换分区"><a href="#1-查看操作系统中是否已经有交换分区" class="headerlink" title="1.查看操作系统中是否已经有交换分区"></a>1.查看操作系统中是否已经有交换分区</h3><p>使用 <code>sudo swapon -s</code> 或者 <code>free -m</code></p>
<pre><code>total used free shared buffers cached
Mem: 3953 154 3799 0 8 83 -/+
buffers/cache: 62 3890
Swap: 0 0 0
</code></pre><a id="more"></a>
<h3 id="2-检查硬盘使用情况"><a href="#2-检查硬盘使用情况" class="headerlink" title="2.检查硬盘使用情况"></a>2.检查硬盘使用情况</h3><p><code>df -h</code></p>
<p><img src="https://img.blessing.studio/images/2015/07/2015-07-11_14-06-47.png" alt="20150710101458"></p>
<h3 id="3-创建-swap-文件"><a href="#3-创建-swap-文件" class="headerlink" title="3.创建 swap 文件"></a>3.创建 swap 文件</h3><p>有两种方法：</p>
<h4 id="The-Traditional-Slow-Way"><a href="#The-Traditional-Slow-Way" class="headerlink" title="The Traditional, Slow Way"></a>The Traditional, Slow Way</h4><p>Traditionally, we would create a file with preallocated space by using the <code>dd</code> command. This versatile disk utility writes from one location to another location.</p>
<p>We can use this to write zeros to the file from a special device in Linux systems located at <code>/dev/zero</code> that just spits out as many zeros as requested.</p>
<p>We specify the file size by using a combination of <code>bs</code> for block size and <code>count</code> for the number of blocks. What we assign to each parameter is almost entirely arbitrary. What matters is what the product of multiplying them turns out to be.</p>
<p>For instance, in our example, we’re looking to create a 4 Gigabyte file. We can do this by specifying a block size of 1 Gigabyte and a count of 4:</p>
<pre><code>$ sudo dd if=/dev/zero of=/swapfile bs=1G count=4

4+0 records in
4+0 records out
4294967296 bytes (4.3 GB) copied, 18.6227 s, 231 MB/s
</code></pre><p>Check your command before pressing ENTER because this has the potential to destroy data if you point the <code>of</code> (which stands for output file) to the wrong location.</p>
<p>We can see that 4 Gigabytes have been allocated by typing:</p>
<pre><code>$ ls -lh /swapfile

-rw-r--r-- 1 root root 4.0G Apr 28 17:15 /swapfile
</code></pre><p>If you’ve completed the command above, you may notice that it took quite a while. In fact, you can see in the output that it took my system 18 seconds to create the file. That is because it has to write 4 Gigabytes of zeros to the disk.</p>
<p>If you want to learn how to create the file faster, remove the file and follow along below:</p>
<p><code>sudo rm /swapfile</code></p>
<h4 id="The-Faster-Way-（推荐）"><a href="#The-Faster-Way-（推荐）" class="headerlink" title="The Faster Way （推荐）"></a>The Faster Way （推荐）</h4><p><code>fallocate -l 2G /swapfile</code> 创建一个 2G 的 swap 文件</p>
<p>这时候用 <code>ls -lh /swapfile</code> 可以查看已创建的 swap files</p>
<p><img src="https://img.blessing.studio/images/2015/07/2015-07-11_14-12-21.png" alt="20150710101618"></p>
<h3 id="4-启用创建的-swap-文件"><a href="#4-启用创建的-swap-文件" class="headerlink" title="4.启用创建的 swap 文件"></a>4.启用创建的 swap 文件</h3><p>设置权限 <code>chmod 600 /swapfile</code>  使之更安全</p>
<p>使用 <code>ls -lh /swapfile</code> 验证权限配置是否生效</p>
<p><img src="https://img.blessing.studio/images/2015/07/2015-07-11_14-14-14.png" alt="20150710101712"></p>
<p>告诉系统将此文件做为 swap 空间使用 <code>mkswap /swapfile</code></p>
<p>启用~ <code>swapon /swapfile</code></p>
<p>可以使用 <code>swapon -s</code> 验证是否生效 <img src="https://img.blessing.studio/images/2015/07/2015-07-11_14-18-18.png" alt="20150710101817"></p>
<p>现在可以再用 <code>free -m&lt;</code> 看看了</p>
<p><img src="https://img.blessing.studio/images/2015/07/2015-07-11_14-19-51.png" alt="20150710101856"></p>
<h3 id="5-持久性地启用你的-swap-file"><a href="#5-持久性地启用你的-swap-file" class="headerlink" title="5.持久性地启用你的 swap file"></a>5.持久性地启用你的 swap file</h3><p>现在虽然启用了，但是每次重启后，系统是<strong>不会</strong>帮我们自动启用 swap file 的</p>
<p>可以通过修改 fstab 文件 <code>vim /etc/fstab</code> 在文件底部加入这样一行</p>
<pre><code>/swapfile none swap sw 0 0
</code></pre><p>实现每次启动自动启用 swap file ~</p>
<h3 id="6-微调你的-swap-配置-（懒得翻译了。。趴-つд⊂"><a href="#6-微调你的-swap-配置-（懒得翻译了。。趴-つд⊂" class="headerlink" title="6.微调你的 swap 配置 （懒得翻译了。。趴 (つд⊂)"></a>6.微调你的 swap 配置 （懒得翻译了。。趴 (つд⊂)</h3><p><strong>注意，下面的文章出现了一些奇异的排版错误，crayon 的锅（逃</strong></p>
<p>There are a few options that you can configure that will have an impact on your system’s performance when dealing with swap.</p>
<p>The <code>swappiness</code> parameter configures how often your system swaps data out of RAM to the swap space. This is a value between 0 and 100 that represents a percentage.</p>
<p>With values close to zero, the kernel will not swap data to the disk unless absolutely necessary. Remember, interactions with the swap file are “expensive” in that they take a lot longer than interactions with RAM and they can cause a significant reduction in performance. Telling the system not to rely on the swap much will generally make your system faster.</p>
<p>Values that are closer to 100 will try to put more data into swap in an effort to keep more RAM space free. Depending on your applications’ memory profile or what you are using your server for, this might be better in some cases.</p>
<p>We can see the current swappiness value by typing:</p>
<pre><code>$ cat /proc/sys/vm/swappiness

60
</code></pre><p>For a Desktop, a swappiness setting of 60 is not a bad value. For a VPS system, we’d probably want to move it closer to 0.</p>
<p>We can set the swappiness to a different value by using the <code>sysctl</code> command.</p>
<p>For instance, to set the swappiness to 10, we could type:</p>
<pre><code>$ sudo sysctl vm.swappiness=10

vm.swappiness = 10
</code></pre><p>This setting will persist until the next reboot. We can set this value automatically at restart by adding the line to our <code>/etc/sysctl.conf</code> file:</p>
<pre><code>$ sudo nano /etc/sysctl.conf
</code></pre><p>At the bottom, you can add:</p>
<pre><code>vm.swappiness=10
</code></pre><p>Save and close the file when you are finished.</p>
<p>Another related value that you might want to modify is the <code>vfs_cache_pressure</code>. This setting configures how much the system will choose to cache inode and dentry information over other data.</p>
<p>Basically, this is access data about the filesystem. This is generally very costly to look up and very frequently requested, so it’s an excellent thing for your system to cache. You can see the current value by querying the <code>proc</code> filesystem again:</p>
<pre><code>$ cat /proc/sys/vm/vfs_cache_pressure

100
</code></pre><p>As it is currently configured, our system removes inode information from the cache too quickly. We can set this to a more conservative setting like 50 by typing:</p>
<pre><code>$ sudo sysctl vm.vfs_cache_pressure=50

vm.vfs_cache_pressure = 50
</code></pre><p>Again, this is only valid for our current session. We can change that by adding it to our configuration file like we did with our swappiness setting:</p>
<pre><code>$ sudo nano /etc/sysctl.conf
</code></pre><p>At the bottom, add the line that specifies your new value:</p>
<pre><code>vm.vfs_cache_pressure = 50
</code></pre><p>Save and close the file when you are finished.</p>
<h3 id="7-总结"><a href="#7-总结" class="headerlink" title="7.总结"></a>7.总结</h3><p>如果你总是碰到 OOM (Out of Memory) 错误，或者你的系统无法运行你需要的应用的话，最好的选择是优化你的应用配置或者升级你的配置。。调整 swap 配置然并卵</p>
<p><img src="https://img.blessing.studio/images/2015/07/2015-07-10_10-57-26.jpg" alt="20150710185714"></p>

      <div class="post-about"><p>除另有声明外，本博客文章均采用 <a href="http://creativecommons.org/licenses/by-nc-sa/3.0/cn/">知识共享(Creative Commons) 署名-非商业性使用-相同方式共享 3.0 中国大陆许可协议</a> 进行许可。</p></div>
    </div>

    <div class="post-meta clf">
  <span class="pmt pms fa-book">
    
      <a class="category-link" href="/categories/tech/">技术</a>
    
  </span>
  <span class="pmt pms fa-clock-o">2015-07-11</span>
  <span class="pmt pms fa-eye">
    <span id="post-view" data="ubuntu-14-04-add-swap-2/">Loading</span> Hits
  </span>
  <span class="pmt pms extra fa-tag">
    
      <a class="tag-link" href="/tag/Linux/">Linux</a>
    
  </span>
</div>

  </article>

  
    <div class="disqus"></div>

<p class="disqus-notice hentry"  style="display: none;">
  <i class="fa fa-spinner fa-spin" aria-hidden="true"></i>  如果评论框加载不出来，那就说明 Disqus 被墙了，你看着办吧 |ー` )
</p>

  

        </div>

        <div id="sidebar" class="fl">

  <div id="abovesb">
    <div class="card">
      <div class="gr center">
        <p id="music-toggle">
          <i class="fa fa-play-circle" aria-hidden="true"></i>
        </p>
        <img src="/images/avatar.jpg" width="112" height="112">
      </div>

      <div class="blogname">Blessing Studio</div>
      <div class="blogdesc">但为君故，沉吟至今。</div>

      <div class="sbmenu">
        <div class="menu-container">
          <ul class="menu">
  
    
    <li class="menu-item menu-item-popular">
      <a href="/popular-posts" title="(=ﾟωﾟ)=" rel="section">
        <i class="fa fa-star"></i>最受欢迎的文章
      </a>
    </li>
  
    
    <li class="menu-item menu-item-friends">
      <a href="/friends" title="友情链接" rel="section">
        <i class="fa fa-link"></i>我的小伙伴们
      </a>
    </li>
  
    
    <li class="menu-item menu-item-about">
      <a href="/about" title="(*ﾟ∀ﾟ*)" rel="section">
        <i class="fa fa-code"></i>关于我
      </a>
    </li>
  
</ul>

        </div>
      </div>
    </div>
    
    <div id="music-player" class="aplayer hide rotated"></div>
  </div>

  <script type="text/javascript">nanobar.go(40);</script>

  <div id="sb">
    
<div id="sbpin">
  
  <div class="clf widget-item widget_text">
    <div class="textwidget">
      <script type="text/javascript" src="https://work.prinzeugen.net/hitokoto/hitokoto.php?encode=javascript"></script>
      <p id="hitokoto"><script>hitokoto();</script></p>
    </div>
  </div>

  
  <div class="clf widget-item widget_text">
    <div class="textwidget">
      <div class="like-widget">
        <p class="like-title">Do you like me ?</p>
        <div style="margin: -3px 0 -2px;">
          <a class="like-vote">
            <i id="heart" class="fa fa-heart-o"></i> <span id="count"><span>
          </a>
        </div>
      </div>
    </div>
  </div>

</div>

  </div>

</div>

      </div><!-- #container -->

      <div id="foot" class="fw">
        <div id="bottom" class="fw">
  <div id="footer" class="wc center clf">
    <div class="info">
      <p>Copyleft 2017 <a href="https://blessing.studio">Blessing Studio</a>. Proudly published with <a href="https://hexo.io/" target="_blank">Hexo</a>. Made with ❤ by printempw.</p>
    </div>
  </div>
</div>

      </div>

    </div><!-- #pageframe.fw -->
    <script type="text/javascript">nanobar.go(80);</script>

    <div class="back-to-top">
      <span class="fa fa-angle-up"></span>
    </div>

    <script src="/js/jquery-2.2.0.min.js"></script>
<script src="/js/jquery.libs.js"></script>
<script src="/js/highlight.min.js"></script>
<script src="/libs/fancybox/source/jquery.fancybox.pack.js"></script>
<script src="/js/script.js"></script>

    
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-65656002-1', 'auto');
  ga('send', 'pageview');

</script>


    <script type="text/javascript">
    $("a.like-vote").mouseover(function() {
        $("#heart").removeClass("fa-heart-o");
        $("#heart").addClass("fa-heart");
    });

    $("a.like-vote").mouseout(function() {
        $("#heart").removeClass("fa-heart");
        $("#heart").addClass("fa-heart-o");
    });

    $.getJSON("//work.prinzeugen.net/do-you-like-me/like.php?action=get", function (data) {
        $('#count').html(data.like);
    });

    $('.like-vote').click(function () {
        if ($('.like-title').html() === 'Do you like me ?') {
            $.getJSON("//work.prinzeugen.net/do-you-like-me/like.php?action=add", function (data) {
                if (data.success) {
                    $('#count').fadeOut(200);
                    $('#count').html(String(parseInt(data.like)));
                    $('#count').fadeIn(200);
                    $('.like-title').html('我也喜欢你 (*≧▽≦)');
                }
                else {
                    $('.like-title').html('你的爱我已经感受到了~');
                }
            });
        }
    });
</script>

    <style type="text/css">
    .menu-item-kaomoji a {
        -moz-user-select: none;
        -webkit-user-select: none;
        -ms-user-select: none;
    }

    .info-rise {
        z-index: 99999;
        position: absolute;
        padding: 0 4px;
        border-radius: 1px;
        background-color: #f69;
        box-shadow: 0 0 1px rgba(0,0,0,0.1);
        color: #fff;
        text-align: center;
        font-size: 12px;
        line-height: 1.5;
        cursor: default
    }
</style>

<script type="text/javascript">
    var kaomoji_array = ["|∀ﾟ", "(´ﾟДﾟ`)", "(;´Д`)", "(｀･ω･)", "(=ﾟωﾟ)=", "| ω・´)", "|-` )", "|д` )", "|ー` )", "|∀` )", "(つд⊂)", "(ﾟДﾟ≡ﾟДﾟ)", "(＾o＾)ﾉ", "(|||ﾟДﾟ)", "( ﾟ∀ﾟ)", "( ´∀`)", "(*´∀`)", "(*ﾟ∇ﾟ)", "(*ﾟーﾟ)", "(　ﾟ 3ﾟ)", "( ´ー`)", "( ・_ゝ・)", "( ´_ゝ`)", "(*´д`)", "(・ー・)", "(・∀・)", "(ゝ∀･)", "(〃∀〃)", "(*ﾟ∀ﾟ*)", "( ﾟ∀。)", "( `д´)", "(`ε´ )", "(`ヮ´ )", "σ`∀´)", " ﾟ∀ﾟ)σ", "ﾟ ∀ﾟ)ノ", "(╬ﾟдﾟ)", "(|||ﾟдﾟ)", "( ﾟдﾟ)", "Σ( ﾟдﾟ)", "( ;ﾟдﾟ)", "( ;´д`)", "(　д ) ﾟ ﾟ", "( ☉д⊙)", "(((　ﾟдﾟ)))", "( ` ・´)", "( ´д`)", "( -д-)", "(>д<)", "･ﾟ( ﾉд`ﾟ)", "( TдT)", "(￣∇￣)", "(￣3￣)", "(￣ｰ￣)", "(￣ . ￣)", "(￣皿￣)", "(￣艸￣)", "(￣︿￣)", "(￣︶￣)", "ヾ(´ωﾟ｀)", "(*´ω`*)", "(・ω・)", "( ´・ω)", "(｀・ω)", "(´・ω・`)", "(`・ω・´)", "( `_っ´)", "( `ー´)", "( ´_っ`)", "( ´ρ`)", "( ﾟωﾟ)", "(oﾟωﾟo)", "(　^ω^)", "(｡◕∀◕｡)", "/( ◕‿‿◕ )\\", "ヾ(´ε`ヾ)", "(ノﾟ∀ﾟ)ノ", "(σﾟдﾟ)σ", "(σﾟ∀ﾟ)σ", "|дﾟ )", "┃電柱┃", "ﾟ(つд`ﾟ)", "ﾟÅﾟ )　", "⊂彡☆))д`)", "⊂彡☆))д´)", "⊂彡☆))∀`)", "(´∀((☆ミつ"];
    var hits = 0;
    var start_time = 0;

    $('.menu-item-kaomoji a').click(function(e) {

        if (start_time == 0) start_time = Date.now();

        hits ++;

        if (hits % 5 === 0) {
            index = Math.floor(Math.random() * kaomoji_array.length);
            $(this).html(kaomoji_array[index]);
        }

        x = $(this).offset().left + $(this).width();
        y = $(this).offset().top + $(this).height();

        if (hits % 50 === 0) {
            var duration = 2000;
            // actions per minite
            var apm = parseInt(hits / ((Date.now() - start_time) / 1000) * 60);
            start_time = 0;
            hits = 0;
            hit = $('<span class="info-rise" style="border: 1px solid #ffd6e4;font-size:13.5px;z-index:9999999;">手速：'+apm+' actions/min </span>');

            console.log('APM: '+apm);
        } else {
            var duration = 500;
            hit = $('<span class="info-rise">+1</span>');
        }

        hit.appendTo($("body"));

        hit.css({
            opacity: 0,
            left: x,
            top: y
        }).animate({
            opacity: 1,
            top: y - 16
        }, 250).animate({
            opacity: 1,
            top: y - 20
        }, duration).animate({
            top: y - 20
        }, duration).animate({
            opacity: 0,
            top: y - 32
        }, 250, function() {
            return $(this).remove();
        });

    });
</script>

    <style type="text/css">
    .p-load-gist {
        margin: 25px 0 25px !important;
        text-align: center;
    }
</style>

<script type="text/javascript">
    $('.load-gist').on('click', function() {
        var gist = {
            url: '//work.prinzeugen.net/gist/printempw/' + $(this).data('hash') + '.json?callback=?',
            dom: this
        };

        $.getJSON(gist.url, function(data) {
            gist.style      = document.createElement('link');
            gist.style.type = 'text/css';
            gist.style.rel  = 'stylesheet';
            gist.style.href = data.stylesheet;

            document.getElementsByTagName('HEAD')[0].appendChild(gist.style);

            $(gist.dom).after(data.div).remove();
        });
    });
</script>

    <script type="text/javascript">
    String.prototype.cleanSlug = function () {
        var search = '/index.html';

        if (this.indexOf(search) === -1) {
            return this.slice(0, -1)
        } else {
            return this.replace(search, '');
        }
    }

    var Counter = function (url) {
        this.baseCounterUrl = url;

        this.initAllPostViews = function () {
            var self = this;

            // 遍历 post-view
            $('[id=post-view]').each(function () {
                // 默认 PV 设为 0
                var span = $(this).html(0);
                var slug = span.attr('data').cleanSlug();

                self.getPostViewBySlug(slug, function (pv) {
                    span.html(pv);
                })
            });
        }

        this.getPostViewBySlug = function (slug, callback) {
            var url = this.baseCounterUrl + '/get/' + slug;

            $.getJSON(url, function (data) {
                callback(data.pv);
            });
        }

        this.incPostViewBySlug = function (slug) {
            var url = this.baseCounterUrl + '/increase/' + slug;

            $.post(url, {}, function (data) {
                $('#post-view').html(data.pv);
            });
        }
    }

    var counter = new Counter('https://work.prinzeugen.net/hexo-view-counter');

    $(document).ready(function () {
        counter.initAllPostViews();
    });
</script>


<script type="text/javascript">
    counter.incPostViewBySlug(
        $('#post-view').attr('data').cleanSlug()
    );
</script>


    <script src="/js/APlayer.min.js"></script>
<script type="text/javascript">
    var player = undefined;

    $.getJSON('https://work.prinzeugen.net/music/play_list.json', function (json) {
        // APlayer.addMusic sucks
        // And APlayer does not provide any method to remove
        // the automatically added music [undefined]
        player = new APlayer({
            element: document.getElementById('music-player'),
            narrow: false,
            autoplay: false,
            showlrc: false,
            mutex: true,
            preload: 'none',
            theme: '#367FA9',
            music: json
        });

        console.log('Music player initialized', json);
    });

    $('#music-toggle').click(function () {
        if (player === undefined) {
            return;
        }

        $('.card').addClass('rotated').addClass('hide');

        // I don't know why APlayer 1.6.0 tends to
        // attach "height: 0px" style to .aplayer-list automatically
        $('.aplayer-list').removeAttr('style')

        $('#music-player').removeClass('hide');

        $('#abovesb').css('padding', 0);

        setTimeout(function () {
            $('#music-player').removeClass('rotated');
        }, 10);
    });

    $('body').on('click', '.aplayer-icon-menu', function () {
        $('.aplayer-list').removeClass('aplayer-list-hide');

        $('#music-player').addClass('rotated').addClass('hide');

        $('.card').removeClass('hide');

        setTimeout(function () {
            $('.card').removeClass('rotated');
        }, 10);

        $('#abovesb').css('padding', '7px 0 1px');
    });
</script>


    
  <script src="/js/jquery.disqusloader.js"></script>

<script type="text/javascript">
  $.disqusLoader('.disqus', {
    scriptUrl: '//blessing-studio.disqus.com/embed.js',
    laziness: 0,
    preLoadCallback: function () {
        $('.disqus-notice').show()
    },
    disqusConfig: function () {
      this.callbacks.onReady = [function () {
        $('.disqus-notice').hide()
      }];
    }
  });
</script>



    <script type="text/javascript">nanobar.go(100);</script>
  </body>
</html>
