<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />


<meta name="theme-color" content="#3C8DBC">
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="HandheldFriendly" content="True" />


<meta name="description" content="这里是 @printempw 的个人博客，基本上啥都写：开发心得分享，日常吐槽吹逼，偶尔也会写正经文字，欢迎订阅。" />

  <meta name="keywords" content="Nginx,PHP,Apache," />




<meta name="google-site-verification" content="WUNRfYChNMDduwLOFHG41TsVrre6BOaI7jKshEvtRts" />



<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">


<meta name="generator" content="Hexo" />


<meta name="description" content="看到这个标题，有人可能会想吐槽： 你他娘的写了这么久 PHP，怎么现在想起来搭建开发环境了？ 呃，情况呢是这么个情况，我之前开发的那个 PHP 项目 (printempw/blessing-skin-server) 在两个月前发布 v3.5.0 版本后基本就已经告一段落了。虽然我本意是不再更新（弃坑的委婉说法），因为当前的版本已经足够完善，该有的东西都有了（而且说实话搞了这么久我也腻味，不仅是对这">
<meta name="keywords" content="Nginx,PHP,Apache">
<meta property="og:type" content="article">
<meta property="og:title" content="Windows 下手动搭建 PHP + Nginx&#x2F;Apache 开发环境">
<meta property="og:url" content="https://blessing.studio/setup-nginx-php-on-windows/index.html">
<meta property="og:site_name" content="Blessing Studio">
<meta property="og:description" content="看到这个标题，有人可能会想吐槽： 你他娘的写了这么久 PHP，怎么现在想起来搭建开发环境了？ 呃，情况呢是这么个情况，我之前开发的那个 PHP 项目 (printempw/blessing-skin-server) 在两个月前发布 v3.5.0 版本后基本就已经告一段落了。虽然我本意是不再更新（弃坑的委婉说法），因为当前的版本已经足够完善，该有的东西都有了（而且说实话搞了这么久我也腻味，不仅是对这">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://img.blessing.studio/images/2018/11/01/php-cgi-processes.png">
<meta property="og:image" content="https://img.blessing.studio/images/2018/11/01/nginx-php-works.png">
<meta property="og:image" content="https://img.blessing.studio/images/2018/11/01/wnmp-all-processes.png">
<meta property="og:updated_time" content="2018-11-01T15:00:10.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Windows 下手动搭建 PHP + Nginx&#x2F;Apache 开发环境">
<meta name="twitter:description" content="看到这个标题，有人可能会想吐槽： 你他娘的写了这么久 PHP，怎么现在想起来搭建开发环境了？ 呃，情况呢是这么个情况，我之前开发的那个 PHP 项目 (printempw/blessing-skin-server) 在两个月前发布 v3.5.0 版本后基本就已经告一段落了。虽然我本意是不再更新（弃坑的委婉说法），因为当前的版本已经足够完善，该有的东西都有了（而且说实话搞了这么久我也腻味，不仅是对这">
<meta name="twitter:image" content="https://img.blessing.studio/images/2018/11/01/php-cgi-processes.png">
<meta name="twitter:creator" content="@printempw">





  <link rel="alternate" href="/atom.xml" title="Blessing Studio">



  <link rel="canonical" href="https://blessing.studio/setup-nginx-php-on-windows/"/>



<link rel="shortcut icon" href="/images/favicon.ico">
<link rel="icon" sizes="192x192" href="/images/icon.png" />
<link rel="apple-touch-icon" sizes="144x144" href="/images/touch-icon.png" />


<link rel="stylesheet" href="/css/main.css">
<link rel="stylesheet" href="/libs/fancybox/source/jquery.fancybox.css">
<link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">


<link rel="stylesheet" type="text/css" href="https://fonts.cat.net/css?family=Alegreya" />
<link rel="stylesheet" type="text/css" href="https://fonts.cat.net/css?family=Alegreya+SC" />
<link rel="stylesheet" type="text/css" href="https://fonts.cat.net/css?family=Roboto+Slab">
<link rel="stylesheet" type="text/css" href="https://fonts.cat.net/css?family=PT+Serif">


    <title>Windows 下手动搭建 PHP + Nginx/Apache 开发环境 - Blessing Studio</title>
  </head>

  <body lang="zh-CN">

    <div id="pageframe" class="fw">
      <script type="text/javascript" src="/js/nanobar.js"></script>
<script type="text/javascript">
    /* Initial NanoBar */
    var nanobar = new Nanobar({
        bg: "#BEDBEC",
        target: document.getElementById("pageframe"),
        id: "inb"
    });
</script>


      <div id="top" class="fw clf">
        <div id="header" class="wc center">
  <div class="logo-container left">
    
    <div class="logo left">
      <a href="https://blessing.studio"><img src="/images/logo.png"></a>
    </div>
  </div>

  <div class="social right">
    
    <div class="ico right" id="tg-s"><a href="javascript:void()" class="fa fa-search"></a></div>
    <form role="search" method="get" id="searchform-top" action="https://www.google.com/search">
      <input type="hidden" name="sitesearch" value="https://blessing.studio">
      <input type="text" name="q" id="s-top" placeholder="搜一搜 (ゝω·)☆ " />
    </form>

    
    <div id="toggler" class="right">
      
        
          <div class="ico">
            <a href="https://twitter.com/printempw" target="_blank" title="Twitter" class="fa fa-twitter"></a>
          </div>
        
          <div class="ico">
            <a href="https://github.com/printempw" target="_blank" title="GitHub" class="fa fa-github"></a>
          </div>
        
      
      <div class="ico">
        <a href="/atom.xml" target="_blank" class="fa fa-rss" ></a>
      </div>
    </div>

    <div class="ico right" id="tg-m"><a href="javascript:;" class="fa fa-bars"></a></div>
  </div>

  <div class="topmenu left">
    <div class="menu-container">
      <ul class="menu">
  
    
    <li class="menu-item menu-item-tech">
      <a href="/categories/tech/" title="提高姿势水平" rel="section">
      技术
      </a>
    </li>
  
    
    <li class="menu-item menu-item-archive">
      <a href="/archives/" title="总览历史文章" rel="section">
      归档
      </a>
    </li>
  
    
    <li class="menu-item menu-item-kaomoji">
      <a href="javascript:void;" title="点我点我" rel="section">
      (´・ω・`)
      </a>
    </li>
  
</ul>

    </div>
  </div>
  <div class="left clf"></div>

</div>

      </div>

      <div id="container" class="wc center clf page-post">
        <script type="text/javascript">nanobar.go(20);</script>

        <div id="content" class="wp">
          

  
  <article class="post post-type-normal hentry">
    <h1 class="post-title">
      <a href="/setup-nginx-php-on-windows/">Windows 下手动搭建 PHP + Nginx/Apache 开发环境</a>
    </h1>

    






    <div class="post-content">
      
      <div class="toc-container">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#0x01-安装-Nginx-Apache"><span class="toc-text">0x01 安装 Nginx / Apache</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x02-安装-PHP"><span class="toc-text">0x02 安装 PHP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x03-配置-FastCGI-转发"><span class="toc-text">0x03 配置 FastCGI 转发</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x04-编写启停脚本"><span class="toc-text">0x04 编写启停脚本</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x05-后记"><span class="toc-text">0x05 后记</span></a></li></ol>
      </div>
      
      <p>看到这个标题，有人可能会想吐槽：</p>
<p><strong>你他娘的写了这么久 PHP，怎么现在想起来搭建开发环境了？</strong></p>
<p>呃，情况呢是这么个情况，我之前开发的那个 PHP 项目 (<a href="https://github.com/printempw/blessing-skin-server/" target="_blank" rel="noopener">printempw/blessing-skin-server</a>) 在两个月前发布 v3.5.0 版本后基本就已经告一段落了。虽然我本意是不再更新<del>（弃坑的委婉说法）</del>，因为当前的版本已经足够完善，该有的东西都有了（而且说实话搞了这么久我也腻味，不仅是对这个程序，还有对国内 Minecraft 开发生态以及用户群体的失望）。</p>
<p>不过我的朋友 <a href="https://blog.gplane.win/" target="_blank" rel="noopener">g-plane</a> 说他愿意接坑，所以现在这个项目的后续开发都是他在搞。而我也乐得清闲，做个甩手掌柜 <a href="https://blessing.studio/vscode-c-cpp-configuration-for-acm-oj/">搞别的</a> 去了。当我摸鱼正快活时，他过来联系我说准备发布 4.0.0-alpha 了，我才想起来这茬：「啊，我连新版本长啥样都还不知道呢！😂」于是急急忙忙 pull 了新代码准备 review 一下，却发现我的新笔电上甚至压根儿就没安装 PHP 开发环境，只能说是非常地真实。</p>
<p>因为 <a href="https://blessing.studio/phpstudy-prober-page-502-bad-gateway/">某些原因</a>，我不想继续使用那些 PHP 一键包来搭建开发环境了，所以这次我打算全部自己来。本文记录了我手动安装配置 PHP + Nginx/Apache 开发环境的过程，希望能帮到后来人。</p>
<p>注意，本文中的配置适用于本地开发环境，应用至生产环境时要注意哦。</p>
<a id="more"></a>
<h2 id="0x01-安装-Nginx-Apache"><a href="#0x01-安装-Nginx-Apache" class="headerlink" title="0x01 安装 Nginx / Apache"></a>0x01 安装 Nginx / Apache</h2><p><strong>如果你用的是 Nginx：</strong></p>
<ul>
<li>去 <a href="https://nginx.org/en/download.html" target="_blank" rel="noopener">官网</a> 下载 Windows 版的 Nginx（我下载的是 <code>nginx-1.14.0.zip</code>）；</li>
<li>解压至你喜欢的地方（我放在 <code>E:\environment\nginx</code> 里）；</li>
<li>直接双击运行 <code>nginx.exe</code>；</li>
<li>如果能正常访问 <code>http://localhost:80</code>，就可以进行下一步了。</li>
</ul>
<p>推荐修改的 <code>nginx.conf</code> 配置如下：</p>
<pre><code class="nginx"># 可以适当调高，但不要超过 CPU 核心数量
worker_processes  4;

events {
    # 开发环境下不用太考虑 worker 最大并发连接数
    worker_connections  1024;
}

http {
    include       mime.types;
    default_type  application/octet-stream;
    sendfile      on;
    keepalive_timeout 65;

    # 启用 gzip
    gzip on;
    gzip_disable &quot;MSIE [1-6].(?!.*SV1)&quot;;
    gzip_http_version 1.1;
    gzip_vary on;
    gzip_proxied any;
    gzip_min_length 1000;
    gzip_buffers 16 8k;
    gzip_comp_level 6;
    gzip_types text/plain text/css text/xml text/javascript application/json application/x-javascript application/xml application/xml+rss;

    # 这里面的内容等 0x03 再细说
    include vhosts.conf;
}
</code></pre>
<p><strong>如果你用的是 Apache：</strong></p>
<ul>
<li>因为 Apache 官网并不提供 Windows 版的构建下载，所以需要去 <a href="https://www.apachelounge.com/download/" target="_blank" rel="noopener">Apache Lounge</a> 或者其他 <a href="https://httpd.apache.org/docs/current/platform/windows.html#down" target="_blank" rel="noopener">官方推荐的站点</a> 下载预编译二进制包（我下载的是 <code>httpd-2.4.37-win64-VC15.zip</code>，你愿意的话也可以自己编译）；</li>
<li>解压至你喜欢的地方（我放在 <code>E:\environment\apache</code> 里）；</li>
<li>直接双击运行 <code>bin/httpd.exe</code>；</li>
<li>如果能正常访问 <code>http://localhost:80</code>，就可以进行下一步了。</li>
</ul>
<p>推荐修改的 <code>httpd.conf</code> 配置如下：</p>
<pre><code class="apache"># 修改为你的安装目录
Define SRVROOT &quot;E:\environment\apache&quot;
ServerRoot &quot;${SRVROOT}&quot;

Listen 80
ServerName localhost

# 按需启用模块
LoadModule rewrite_module modules/mod_rewrite.so
LoadModule ...

# 推荐注释掉自带的 DocumentRoot 和 &lt;Directory&gt;
# 这里面的内容等 0x03 再细说
Include conf/extra/httpd-php.conf
Include conf/vhosts.conf
</code></pre>
<h2 id="0x02-安装-PHP"><a href="#0x02-安装-PHP" class="headerlink" title="0x02 安装 PHP"></a>0x02 安装 PHP</h2><p>Windows 版 PHP 下载地址：</p>
<p><a href="https://windows.php.net/download" target="_blank" rel="noopener">https://windows.php.net/download</a></p>
<p>其中有 NTS（Non Thread Safe，非线程安全）和 TS（Thread Safe，线程安全）两种版本，简单来说就是 <strong>Nginx 用 NTS 版，Apache 通常用 TS 版</strong>（也可以用 NTS），它们之间的具体区别有兴趣的话可以自己去了解一下。</p>
<p>为了同时兼容 Nginx 与 Apache，本文将以 NTS 版为例进行配置。</p>
<ul>
<li>下载合适的版本（我下载的是 <code>php-7.2.11-nts-Win32-VC15-x64.zip</code>）；</li>
<li>解压至你喜欢的位置（我放在 <code>E:\environment\php</code> 里）；</li>
<li>复制一份 <code>php.ini-development</code>，重命名为 <code>php.ini</code> 并适当修改其中配置；</li>
<li>直接双击运行 <code>php.exe</code>；</li>
<li>如果能正常打开 PHP Interactive Shell，就可以进入下一步了。</li>
</ul>
<p><strong>如果无法运行，请检查你是否安装了对应的 VC 运行库。</strong></p>
<p>推荐修改的 <code>php.ini</code> 配置如下：</p>
<pre><code class="ini">; 扩展所在的目录，自行修改
extension_dir = &quot;E:\environment\php\ext&quot;
; 按自己的需求启用扩展
extension=pdo_mysql
extension=...
; 各种缓存的位置
sys_temp_dir = &quot;E:\environment\php\temp&quot;
upload_tmp_dir = &quot;E:\environment\php\temp&quot;
session.save_path = &quot;E:\environment\php\temp&quot;
; 其他杂七杂八的
upload_max_filesize = 100M
date.timezone = Asia/Shanghai
</code></pre>
<h2 id="0x03-配置-FastCGI-转发"><a href="#0x03-配置-FastCGI-转发" class="headerlink" title="0x03 配置 FastCGI 转发"></a>0x03 配置 FastCGI 转发</h2><p>接下来才是重头戏，我们要让 Web Server 与 PHP 能够互相通信以完成请求。</p>
<p>作为 Web Server 的后端时，PHP 主要有两种运行方式，一种是 <strong>独立进程、使用 <a href="http://www.nowamagic.net/librarys/veda/detail/1319" target="_blank" rel="noopener">FastCGI 协议</a> 与 Web Server 通信</strong>（Nginx 用的就是这种），另外一种是 <strong>作为模块直接加载到 Web Server 中</strong>（比如 Apache 的 <code>mod_php</code> 模块，不过 Apache 也支持 FastCGI 方式）。详细的原理我就不介绍了，有兴趣的选手可以去了解一下。</p>
<p>为了能够同时兼容 Nginx 和 Apache，<strong>本文均使用 FastCGI 方式加载 PHP</strong>。</p>
<hr>
<p>首先我们需要配置一下 PHP 的 FastCGI 进程管理器。为什么呢？因为直接运行 PHP 的 FastCGI 进程（在 Windows 上就是 <code>php-cgi.exe</code>）有以下缺点：</p>
<ul>
<li>配置文件 <code>php.ini</code> 修改后无法平滑重载，需要重新启动 <code>php-cgi</code> 进程；</li>
<li>Windows 下 <code>php-cgi</code> 默认处理 500 个请求后就自动退出（<code>PHP_FCGI_MAX_REQUESTS</code>）；</li>
<li>如果因为其他原因造成 <code>php-cgi</code> 进程崩溃，就无法处理后续请求了。</li>
</ul>
<p>所以我们需要一个类似守护进程的东西，来保证始终有一定数量的 <code>php-cgi</code> 进程在运行。<a href="http://php.net/manual/zh/install.fpm.php" target="_blank" rel="noopener">PHP-FPM</a> (PHP FastCGI Process Manager) 是 PHP 官方钦定的 FastCGI 进程管理器，但遗憾的是，它只适用于类 Unix 系统。在 Windows 上，我们可以使用这些替代品来实现类似的功能（<strong>Apache 用户不需要配置这些东西</strong>，因为它的 <code>mod_fcgid</code> 模块自带 FastCGI 进程管理功能）：</p>
<ul>
<li><a href="https://github.com/78/xxfpm" target="_blank" rel="noopener">xxfpm</a></li>
<li><a href="https://github.com/deemru/php-cgi-spawner" target="_blank" rel="noopener">php-cgi-spawner</a></li>
<li><a href="https://github.com/lighttpd/spawn-fcgi" target="_blank" rel="noopener">spawn-fcgi</a></li>
</ul>
<p>本文将以 php-cgi-spawner 为例进行配置。</p>
<ul>
<li><p>在 <a href="https://github.com/deemru/php-cgi-spawner/releases" target="_blank" rel="noopener">这里</a> 下载编译好的 <code>php-cgi-spawner.exe</code>；</p>
</li>
<li><p>放到 PHP 的安装目录下（本文为 <code>E:\environment\php</code>）；</p>
</li>
<li><p>打开 PowerShell 或者 CMD，运行命令：</p>
<pre><code class="powershell"># 令 PHP FastCGI 处理程序监听在 9000 端口上
# 至少开启 4 个 php-cgi 进程，高负载时最多可以开到 16 个
.\php-cgi-spawner.exe &quot;php-cgi.exe -c php.ini&quot; 9000 4+16
</code></pre>
</li>
<li><p>如果一切正常，你将可以在任务管理器中看到同时运行的多个 <code>php-cgi</code> 进程。</p>
</li>
</ul>
<p><img src="https://img.blessing.studio/images/2018/11/01/php-cgi-processes.png" alt="php-cgi-processes"></p>
<p><strong>接下来修改 Nginx 配置</strong>（即 0x01 中提到的 <code>vhosts.conf</code> 中的内容），通过 FastCGI 协议将请求转发给监听在 9000 端口上的 PHP 进行处理：</p>
<pre><code class="nginx">server {
    listen       80;
    server_name  localhost;
    root   E:/wwwroot;
    index  index.html index.htm index.php;

    location ~ [^/]\.php(/|$) {
        # 从 URI 中分离出 $fastcgi_script_name 和 $fastcgi_path_info 的值
        # 不推荐使用 php.ini 中的 cgi.fix_pathinfo 选项，这可能会造成安全隐患
        # 虽然我感觉 8012 年了应该没人用 PATH_INFO 了……不需要的话去掉即可
        fastcgi_split_path_info  ^(.+?\.php)(/.*)$;
        fastcgi_param  PATH_INFO  $fastcgi_path_info;

        # 当请求的 .php 文件不存在时直接返回 404
        # 不然交给 PHP 处理的话那边就会返回 No input file specified.
        if (!-f $document_root$fastcgi_script_name) {
            return 404;
        }

        fastcgi_pass   127.0.0.1:9000;
        fastcgi_index  index.php;
        # 自带的配置文件，里面设置了一大堆 CGI 协议中的变量
        include        fastcgi.conf;
    }
}
</code></pre>
<hr>
<p><strong>Apache 用户不需要手动配置 PHP FastCGI 进程管理器，相对简单一些：</strong></p>
<ul>
<li>在上面提到的 <a href="https://www.apachelounge.com/download/" target="_blank" rel="noopener">Apache Lounge</a> 上下载编译好的 <code>mod_fcgid</code> 模块；</li>
<li>解压后，将 <code>mod_fcgid.so</code> 放入 Apache 的 <code>modules</code> 目录；</li>
<li>编辑配置文件加载模块（即 0x01 中提到的 <code>conf/extra/httpd-php.conf</code>）：</li>
</ul>
<pre><code class="apache"># 如果嫌麻烦的话这一段也可以直接放到 httpd.conf 里面去
LoadModule fcgid_module modules/mod_fcgid.so

&lt;IfModule fcgid_module&gt;
FcgidInitialEnv PHPRC &quot;E:/environment/php/&quot;
FcgidInitialEnv PHP_FCGI_MAX_REQUESTS 1000
AddHandler fcgid-script .php
FcgidWrapper &quot;E:/environment/php/php-cgi.exe&quot; .php
FcgidIOTimeout 384
FcgidConnectTimeout 360
FcgidOutputBufferSize 128
FcgidMaxRequestsPerProcess 1000
FcgidMinProcessesPerClass 0
FcgidMaxProcesses 16
FcgidMaxRequestLen 268435456
ProcessLifeTime 360
&lt;/IfModule&gt;
</code></pre>
<ul>
<li>编辑 <code>conf/vhosts.conf</code> 允许运行 CGI 程序：</li>
</ul>
<pre><code class="apache">&lt;VirtualHost localhost:80&gt;
  DocumentRoot &quot;E:\wwwroot&quot;
  &lt;Directory &quot;E:\wwwroot&quot;&gt;
    DirectoryIndex index.html index.php
    # 注意这里的 +ExecCGI，不加的话会 403
    Options -Indexes -FollowSymLinks +ExecCGI
    AllowOverride All
    Order allow,deny
    Allow from all
    Require all granted
  &lt;/Directory&gt;
&lt;/VirtualHost&gt;
</code></pre>
<p>如果一切配置正确，你应该就能正常访问 PHP 网页了。</p>
<p><img src="https://img.blessing.studio/images/2018/11/01/nginx-php-works.png" alt="nginx-php-works"></p>
<h2 id="0x04-编写启停脚本"><a href="#0x04-编写启停脚本" class="headerlink" title="0x04 编写启停脚本"></a>0x04 编写启停脚本</h2><p>虽然整个系统是跑起来了，但总不能每次启动都得开一大堆控制台窗口吧？弄个小工具管理 Nginx/Apache 和 PHP 的进程还是很有必要的。各种一键包中一般都自带了方便好用的界面来管理这些进程，不过既然我们选择了手动配置，那这一块也得我们自己搞定了。因为图方便，我选择使用 Windows 的批处理脚本（Batch File）来完成这项需求，保存为 <code>.bat</code> 文件双击运行就完事儿了。</p>
<p><strong>启动 Nginx 和 PHP：</strong></p>
<pre><code class="cmd">@ECHO OFF
set nginx_home=..\nginx
set php_home=..\php

ECHO Starting PHP FastCGI...
.\RunHiddenConsole.exe %php_home%\php-cgi-spawner.exe &quot;%php_home%\php-cgi.exe -c %php_home%\php.ini&quot; 9000 4+16

ECHO Starting Nginx...
.\RunHiddenConsole.exe %nginx_home%\nginx.exe -p %nginx_home%
</code></pre>
<p><strong>停止 Nginx 和 PHP：</strong></p>
<pre><code class="cmd">@ECHO OFF

ECHO Stopping nginx...
taskkill /F /IM nginx.exe &gt; nul

ECHO Stopping PHP FastCGI...
taskkill /F /IM php-cgi-spawner.exe &gt; nul
taskkill /F /IM php-cgi.exe &gt; nul
</code></pre>
<p><strong>重载 Nginx 配置：</strong></p>
<pre><code class="cmd">@ECHO OFF
set nginx_home=..\nginx

ECHO Reloading Nginx...
%nginx_home%\nginx.exe -s reload
</code></pre>
<p><strong>启动 Apache</strong>（Apache 会帮我们启动 PHP 的）：</p>
<pre><code class="cmd">@ECHO OFF
set apache_home=..\apache

ECHO Starting Apache Httpd...
.\RunHiddenConsole.exe %apache_home%\bin\httpd.exe
</code></pre>
<p><strong>停止 Apache：</strong></p>
<pre><code class="cmd">@ECHO OFF

ECHO Stopping Apache Httpd...
taskkill /F /IM httpd.exe &gt; nul
</code></pre>
<p>这些脚本我放在 <code>E:\environment\scripts</code> 目录中，如果你需要放在其他地方，请适当修改脚本中的可执行文件路径。另外，脚本中用到了 <code>RunHiddenConsole.exe</code> 来隐藏命令行窗口，你可以在 <a href="http://redmine.lighttpd.net/attachments/660/RunHiddenConsole.zip" target="_blank" rel="noopener">这里</a> 下载到这个小工具。</p>
<p><img src="https://img.blessing.studio/images/2018/11/01/wnmp-all-processes.png" alt="wnmp-all-processes"></p>
<h2 id="0x05-后记"><a href="#0x05-后记" class="headerlink" title="0x05 后记"></a>0x05 后记</h2><p>配置完成后的目录结构大概是这样的（有省略）：</p>
<pre><code class="text">E:\environment&gt; tree
.
├── apache
│   ├── bin
│   ├── cgi-bin
│   ├── conf
│   │   ├── extra
│   │   ├── original
│   │   ├── charset.conv
│   │   ├── httpd.conf *
│   │   ├── magic
│   │   ├── mime.types
│   │   ├── openssl.cnf
│   │   └── vhosts.conf *
│   ├── include
│   ├── lib
│   ├── logs
│   └── modules
├── mysql
│   ├── bin
│   ├── data
│   ├── include
│   ├── lib
│   └── share
├── nginx
│   ├── conf
│   │   ├── fastcgi.conf
│   │   ├── fastcgi_params
│   │   ├── koi-utf
│   │   ├── koi-win
│   │   ├── mime.types
│   │   ├── nginx.conf *
│   │   ├── scgi_params
│   │   ├── uwsgi_params
│   │   ├── vhosts.conf *
│   │   └── win-utf
│   ├── contrib
│   ├── logs
│   └── nginx.exe
├── php
│   ├── dev
│   ├── ext
│   ├── extras
│   ├── lib
│   ├── sasl2
│   ├── temp
│   ├── ...
│   ├── php7.dll
│   ├── php-cgi.exe
│   ├── php-cgi-spawner.exe *
│   ├── php.exe
│   └── php.ini *
└── scripts
    ├── reload-nginx.bat
    ├── restart-nginx.bat
    ├── RunHiddenConsole.exe
    ├── start-all.bat
    ├── start-apache.bat
    ├── start-mysql.bat
    ├── start-nginx.bat
    ├── stop-all.bat
    ├── stop-apache.bat
    ├── stop-mysql.bat
    └── stop-nginx.bat
</code></pre>
<p>非常清爽，有种一切尽在掌控中的感觉，我喜欢。</p>
<p>如果你是一名 PHP 开发者，却从来没有手动配置过 PHP 环境的话，那我建议你尝试一下。虽然生产环境上一般都是采用成熟的一键包，不过手动配置一下这一套东西可以更深入地了解 PHP 与 Web Server 的协作机制，这对于编写上层应用以及运维也是很有好处的。</p>
<p>本来想顺带凑齐一套 WNMP，但是 MySQL 的安装配置相对比较简单，而且也不像 PHP 与 Web Server 那样耦合紧密，所以这里就按下不表。</p>
<p>以上。</p>

      <div class="post-about"><p>除另有声明外，本博客文章均采用 <a href="http://creativecommons.org/licenses/by-nc-sa/3.0/cn/">知识共享(Creative Commons) 署名-非商业性使用-相同方式共享 3.0 中国大陆许可协议</a> 进行许可。</p></div>
    </div>

    <div class="post-meta clf">
  <span class="pmt pms fa-book">
    
      <a class="category-link" href="/categories/tech/">技术</a>
    
  </span>
  <span class="pmt pms fa-clock-o">2018-11-01</span>
  <span class="pmt pms fa-eye">
    <span id="post-view" data="setup-nginx-php-on-windows/">Loading</span> Hits
  </span>
  <span class="pmt pms extra fa-tag">
    
      <a class="tag-link" href="/tag/Apache/">Apache</a>, <a class="tag-link" href="/tag/Nginx/">Nginx</a>, <a class="tag-link" href="/tag/PHP/">PHP</a>
    
  </span>
</div>

  </article>

  
    <div class="disqus"></div>

<p class="disqus-notice hentry"  style="display: none;">
  <i class="fa fa-spinner fa-spin" aria-hidden="true"></i>  如果评论框加载不出来，那就说明 Disqus 被墙了，你看着办吧 |ー` )
</p>

  

        </div>

        <div id="sidebar" class="fl">

  <div id="abovesb">
    <div class="card">
      <div class="gr center">
        <p id="music-toggle">
          <i class="fa fa-play-circle" aria-hidden="true"></i>
        </p>
        <img src="/images/avatar.jpg" width="112" height="112">
      </div>

      <div class="blogname">Blessing Studio</div>
      <div class="blogdesc">半吊子全栈开发者的日常</div>

      <div class="sbmenu">
        <div class="menu-container">
          <ul class="menu">
  
    
    <li class="menu-item menu-item-friends">
      <a href="/friends" title="友情链接" rel="section">
        <i class="fa fa-link"></i>我的小伙伴们
      </a>
    </li>
  
    
    <li class="menu-item menu-item-about">
      <a href="/about" title="(*ﾟ∀ﾟ*)" rel="section">
        <i class="fa fa-code"></i>关于我
      </a>
    </li>
  
</ul>

        </div>
      </div>
    </div>
    
    <div id="music-player" class="aplayer hide rotated"></div>
  </div>

  <script type="text/javascript">nanobar.go(40);</script>

  <div id="sb">
    
<div id="sbpin">
  
  
  <div class="clf widget-item widget-toc">
    <h3 class="widget-title">文章目录</h3>
    <div class="textwidget">
      <div class="toc-container">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#0x01-安装-Nginx-Apache"><span class="toc-text">0x01 安装 Nginx / Apache</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x02-安装-PHP"><span class="toc-text">0x02 安装 PHP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x03-配置-FastCGI-转发"><span class="toc-text">0x03 配置 FastCGI 转发</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x04-编写启停脚本"><span class="toc-text">0x04 编写启停脚本</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x05-后记"><span class="toc-text">0x05 后记</span></a></li></ol>
      </div>
    </div>
  </div>
  

  
  <div class="clf widget-item widget_text">
    <div class="textwidget">
      <script type="text/javascript" src="https://work.prinzeugen.net/hitokoto/hitokoto.php?encode=javascript"></script>
      <p id="hitokoto"><script>hitokoto();</script></p>
    </div>
  </div>

  
  

</div>

  </div>

</div>

      </div><!-- #container -->

      <div id="foot" class="fw">
        <div id="bottom" class="fw">
  <div id="footer" class="wc center clf">
    <div class="info">
      <p>Copyleft 2018 <a href="https://blessing.studio">Blessing Studio</a>. Proudly published with <a href="https://hexo.io/" target="_blank">Hexo</a>. Made with ❤ by printempw.</p>
    </div>
  </div>
</div>

      </div>

    </div><!-- #pageframe.fw -->
    <script type="text/javascript">nanobar.go(80);</script>

    <div class="back-to-top">
      <span class="fa fa-angle-up"></span>
    </div>

    <script src="/js/jquery-2.2.0.min.js"></script>
<script src="/js/jquery.libs.js"></script>
<script src="/js/highlight.min.js"></script>
<script src="/libs/fancybox/source/jquery.fancybox.pack.js"></script>
<script src="/js/script.js"></script>

    
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-65656002-1', 'auto');
  ga('send', 'pageview');

</script>


    <script type="text/javascript">
    $("a.like-vote").mouseover(function() {
        $("#heart").removeClass("fa-heart-o");
        $("#heart").addClass("fa-heart");
    });

    $("a.like-vote").mouseout(function() {
        $("#heart").removeClass("fa-heart");
        $("#heart").addClass("fa-heart-o");
    });

    $.getJSON("//work.prinzeugen.net/do-you-like-me/like.php?action=get", function (data) {
        $('#count').html(data.like);
    });

    $('.like-vote').click(function () {
        if ($('.like-title').html() === 'Do you like me ?') {
            $.getJSON("//work.prinzeugen.net/do-you-like-me/like.php?action=add", function (data) {
                if (data.success) {
                    $('#count').fadeOut(200);
                    $('#count').html(String(parseInt(data.like)));
                    $('#count').fadeIn(200);
                    $('.like-title').html('我也喜欢你 (*≧▽≦)');
                }
                else {
                    $('.like-title').html('你的爱我已经感受到了~');
                }
            });
        }
    });
</script>

    <style type="text/css">
    .menu-item-kaomoji a {
        -moz-user-select: none;
        -webkit-user-select: none;
        -ms-user-select: none;
    }

    .info-rise {
        z-index: 99999;
        position: absolute;
        padding: 0 4px;
        border-radius: 1px;
        background-color: #f69;
        box-shadow: 0 0 1px rgba(0,0,0,0.1);
        color: #fff;
        text-align: center;
        font-size: 12px;
        line-height: 1.5;
        cursor: default
    }
</style>

<script type="text/javascript">
    var kaomoji_array = ["|∀ﾟ", "(´ﾟДﾟ`)", "(;´Д`)", "(｀･ω･)", "(=ﾟωﾟ)=", "| ω・´)", "|-` )", "|д` )", "|ー` )", "|∀` )", "(つд⊂)", "(ﾟДﾟ≡ﾟДﾟ)", "(＾o＾)ﾉ", "(|||ﾟДﾟ)", "( ﾟ∀ﾟ)", "( ´∀`)", "(*´∀`)", "(*ﾟ∇ﾟ)", "(*ﾟーﾟ)", "(　ﾟ 3ﾟ)", "( ´ー`)", "( ・_ゝ・)", "( ´_ゝ`)", "(*´д`)", "(・ー・)", "(・∀・)", "(ゝ∀･)", "(〃∀〃)", "(*ﾟ∀ﾟ*)", "( ﾟ∀。)", "( `д´)", "(`ε´ )", "(`ヮ´ )", "σ`∀´)", " ﾟ∀ﾟ)σ", "ﾟ ∀ﾟ)ノ", "(╬ﾟдﾟ)", "(|||ﾟдﾟ)", "( ﾟдﾟ)", "Σ( ﾟдﾟ)", "( ;ﾟдﾟ)", "( ;´д`)", "(　д ) ﾟ ﾟ", "( ☉д⊙)", "(((　ﾟдﾟ)))", "( ` ・´)", "( ´д`)", "( -д-)", "(>д<)", "･ﾟ( ﾉд`ﾟ)", "( TдT)", "(￣∇￣)", "(￣3￣)", "(￣ｰ￣)", "(￣ . ￣)", "(￣皿￣)", "(￣艸￣)", "(￣︿￣)", "(￣︶￣)", "ヾ(´ωﾟ｀)", "(*´ω`*)", "(・ω・)", "( ´・ω)", "(｀・ω)", "(´・ω・`)", "(`・ω・´)", "( `_っ´)", "( `ー´)", "( ´_っ`)", "( ´ρ`)", "( ﾟωﾟ)", "(oﾟωﾟo)", "(　^ω^)", "(｡◕∀◕｡)", "/( ◕‿‿◕ )\\", "ヾ(´ε`ヾ)", "(ノﾟ∀ﾟ)ノ", "(σﾟдﾟ)σ", "(σﾟ∀ﾟ)σ", "|дﾟ )", "┃電柱┃", "ﾟ(つд`ﾟ)", "ﾟÅﾟ )　", "⊂彡☆))д`)", "⊂彡☆))д´)", "⊂彡☆))∀`)", "(´∀((☆ミつ"];
    var hits = 0;
    var start_time = 0;

    $('.menu-item-kaomoji a').click(function(e) {

        if (start_time == 0) start_time = Date.now();

        hits ++;

        if (hits % 5 === 0) {
            index = Math.floor(Math.random() * kaomoji_array.length);
            $(this).html(kaomoji_array[index]);
        }

        x = $(this).offset().left + $(this).width();
        y = $(this).offset().top + $(this).height();

        if (hits % 50 === 0) {
            var duration = 2000;
            // actions per minite
            var apm = parseInt(hits / ((Date.now() - start_time) / 1000) * 60);
            start_time = 0;
            hits = 0;
            hit = $('<span class="info-rise" style="border: 1px solid #ffd6e4;font-size:13.5px;z-index:9999999;">手速：'+apm+' actions/min </span>');

            console.log('APM: '+apm);
        } else {
            var duration = 500;
            hit = $('<span class="info-rise">+1</span>');
        }

        hit.appendTo($("body"));

        hit.css({
            opacity: 0,
            left: x,
            top: y
        }).animate({
            opacity: 1,
            top: y - 16
        }, 250).animate({
            opacity: 1,
            top: y - 20
        }, duration).animate({
            top: y - 20
        }, duration).animate({
            opacity: 0,
            top: y - 32
        }, 250, function() {
            return $(this).remove();
        });

    });
</script>

    <style type="text/css">
    .p-load-gist {
        margin: 25px 0 25px !important;
        text-align: center;
    }
</style>

<script type="text/javascript">
    $('.load-gist').on('click', function() {
        var gist = {
            url: '//work.prinzeugen.net/gist/printempw/' + $(this).data('hash') + '.json?callback=?',
            dom: this
        };

        $.getJSON(gist.url, function(data) {
            gist.style      = document.createElement('link');
            gist.style.type = 'text/css';
            gist.style.rel  = 'stylesheet';
            gist.style.href = data.stylesheet;

            document.getElementsByTagName('HEAD')[0].appendChild(gist.style);

            $(gist.dom).after(data.div).remove();
        });
    });
</script>

    <script type="text/javascript">
    String.prototype.cleanSlug = function () {
        var search = '/index.html';

        if (this.indexOf(search) === -1) {
            return this.slice(0, -1)
        } else {
            return this.replace(search, '');
        }
    }

    var Counter = function (url) {
        this.baseCounterUrl = url;

        this.initAllPostViews = function () {
            var self = this;

            // 遍历 post-view
            $('[id=post-view]').each(function () {
                // 默认 PV 设为 0
                var span = $(this).html(0);
                var slug = span.attr('data').cleanSlug();

                self.getPostViewBySlug(slug, function (pv) {
                    span.html(pv);
                })
            });
        }

        this.getPostViewBySlug = function (slug, callback) {
            var url = this.baseCounterUrl + '/get/' + slug;

            $.getJSON(url, function (data) {
                callback(data.pv);
            });
        }

        this.incPostViewBySlug = function (slug) {
            var url = this.baseCounterUrl + '/increase/' + slug;

            $.post(url, {}, function (data) {
                $('#post-view').html(data.pv);
            });
        }
    }

    var counter = new Counter('https://work.prinzeugen.net/hexo-view-counter');

    $(document).ready(function () {
        counter.initAllPostViews();
    });
</script>


<script type="text/javascript">
    counter.incPostViewBySlug(
        $('#post-view').attr('data').cleanSlug()
    );
</script>


    <script src="/js/APlayer.min.js"></script>
<script type="text/javascript">
    var player = undefined;

    $.getJSON('https://work.prinzeugen.net/music/play_list.json', function (json) {
        // APlayer.addMusic sucks
        // And APlayer does not provide any method to remove
        // the automatically added music [undefined]
        player = new APlayer({
            element: document.getElementById('music-player'),
            narrow: false,
            autoplay: false,
            showlrc: false,
            mutex: true,
            preload: 'none',
            theme: '#367FA9',
            music: json
        });

        console.log('Music player initialized', json);
    });

    $('#music-toggle').click(function () {
        if (player === undefined) {
            return;
        }

        $('.card').addClass('rotated').addClass('hide');

        // I don't know why APlayer 1.6.0 tends to
        // attach "height: 0px" style to .aplayer-list automatically
        $('.aplayer-list').removeAttr('style')

        $('#music-player').removeClass('hide');

        $('#abovesb').css('padding', 0);

        setTimeout(function () {
            $('#music-player').removeClass('rotated');
        }, 10);
    });

    $('body').on('click', '.aplayer-icon-menu', function () {
        $('.aplayer-list').removeClass('aplayer-list-hide');

        $('#music-player').addClass('rotated').addClass('hide');

        $('.card').removeClass('hide');

        setTimeout(function () {
            $('.card').removeClass('rotated');
        }, 10);

        $('#abovesb').css('padding', '7px 0 1px');
    });
</script>


    
  <script src="/js/jquery.disqusloader.js"></script>

<script type="text/javascript">
  $.disqusLoader('.disqus', {
    scriptUrl: '//blessing-studio.disqus.com/embed.js',
    laziness: 0,
    preLoadCallback: function () {
        $('.disqus-notice').show()
    },
    disqusConfig: function () {
      this.callbacks.onReady = [function () {
        $('.disqus-notice').hide()
      }];
    }
  });
</script>



    <script type="text/javascript">nanobar.go(100);</script>
  </body>
</html>
