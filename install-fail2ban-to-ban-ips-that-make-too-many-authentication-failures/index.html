<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />


<meta name="theme-color" content="#3C8DBC">
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="HandheldFriendly" content="True" />


<meta name="description" content="这里是 @printempw 的个人博客，基本上啥都写：开发心得分享，日常吐槽吹逼，偶尔也会写正经文字，欢迎订阅。" />

  <meta name="keywords" content="运维," />




<meta name="google-site-verification" content="WUNRfYChNMDduwLOFHG41TsVrre6BOaI7jKshEvtRts" />



<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">


<meta name="generator" content="Hexo" />


<meta name="description" content="窝一直天真的以为不会有人暴力破解窝的，直到今天看了一下 grep sshd /var/log/auth.log 。。  防止 ssh 暴力破解大概就是使用 ssh key，改端口，关闭口令登录，还有就是 fail2ban，denyhost 之类的软件了，这里窝打算使用 fail2ban。项目地址：GitHub，官网：http://www.fail2ban.org/ __      _ _ ___">
<meta name="keywords" content="运维">
<meta property="og:type" content="article">
<meta property="og:title" content="安装 fail2ban 防止 SSH 暴力破解">
<meta property="og:url" content="https://blessing.studio/install-fail2ban-to-ban-ips-that-make-too-many-authentication-failures/index.html">
<meta property="og:site_name" content="Blessing Studio">
<meta property="og:description" content="窝一直天真的以为不会有人暴力破解窝的，直到今天看了一下 grep sshd /var/log/auth.log 。。  防止 ssh 暴力破解大概就是使用 ssh key，改端口，关闭口令登录，还有就是 fail2ban，denyhost 之类的软件了，这里窝打算使用 fail2ban。项目地址：GitHub，官网：http://www.fail2ban.org/ __      _ _ ___">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://img.blessing.studio/images/2015/08/2015-08-15_12-49-38.png">
<meta property="og:image" content="https://img.blessing.studio/images/2015/08/2015-08-15_13-19-37.png">
<meta property="og:image" content="https://img.blessing.studio/images/2015/08/2015-08-12_12-42-14.jpg">
<meta property="og:updated_time" content="2015-08-28T16:34:52.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="安装 fail2ban 防止 SSH 暴力破解">
<meta name="twitter:description" content="窝一直天真的以为不会有人暴力破解窝的，直到今天看了一下 grep sshd /var/log/auth.log 。。  防止 ssh 暴力破解大概就是使用 ssh key，改端口，关闭口令登录，还有就是 fail2ban，denyhost 之类的软件了，这里窝打算使用 fail2ban。项目地址：GitHub，官网：http://www.fail2ban.org/ __      _ _ ___">
<meta name="twitter:image" content="https://img.blessing.studio/images/2015/08/2015-08-15_12-49-38.png">
<meta name="twitter:creator" content="@printempw">





  <link rel="alternate" href="/atom.xml" title="Blessing Studio">



  <link rel="canonical" href="https://blessing.studio/install-fail2ban-to-ban-ips-that-make-too-many-authentication-failures/"/>



<link rel="shortcut icon" href="/images/favicon.ico">
<link rel="icon" sizes="192x192" href="/images/icon.png" />
<link rel="apple-touch-icon" sizes="144x144" href="/images/touch-icon.png" />


<link rel="stylesheet" href="/css/main.css">
<link rel="stylesheet" href="/libs/fancybox/source/jquery.fancybox.css">
<link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">


<link rel="stylesheet" type="text/css" href="https://fonts.cat.net/css?family=Alegreya" />
<link rel="stylesheet" type="text/css" href="https://fonts.cat.net/css?family=Alegreya+SC" />
<link rel="stylesheet" type="text/css" href="https://fonts.cat.net/css?family=Roboto+Slab">
<link rel="stylesheet" type="text/css" href="https://fonts.cat.net/css?family=PT+Serif">


    <title>安装 fail2ban 防止 SSH 暴力破解 - Blessing Studio</title>
  </head>

  <body lang="zh-CN">

    <div id="pageframe" class="fw">
      <script type="text/javascript" src="/js/nanobar.js"></script>
<script type="text/javascript">
    /* Initial NanoBar */
    var nanobar = new Nanobar({
        bg: "#BEDBEC",
        target: document.getElementById("pageframe"),
        id: "inb"
    });
</script>


      <div id="top" class="fw clf">
        <div id="header" class="wc center">
  <div class="logo-container left">
    
    <div class="logo left">
      <a href="https://blessing.studio"><img src="/images/logo.png"></a>
    </div>
  </div>

  <div class="social right">
    
    <div class="ico right" id="tg-s"><a href="javascript:void()" class="fa fa-search"></a></div>
    <form role="search" method="get" id="searchform-top" action="https://www.google.com/search">
      <input type="hidden" name="sitesearch" value="https://blessing.studio">
      <input type="text" name="q" id="s-top" placeholder="搜一搜 (ゝω·)☆ " />
    </form>

    
    <div id="toggler" class="right">
      
        
          <div class="ico">
            <a href="https://twitter.com/printempw" target="_blank" title="Twitter" class="fa fa-twitter"></a>
          </div>
        
          <div class="ico">
            <a href="https://github.com/printempw" target="_blank" title="GitHub" class="fa fa-github"></a>
          </div>
        
      
      <div class="ico">
        <a href="/atom.xml" target="_blank" class="fa fa-rss" ></a>
      </div>
    </div>

    <div class="ico right" id="tg-m"><a href="javascript:;" class="fa fa-bars"></a></div>
  </div>

  <div class="topmenu left">
    <div class="menu-container">
      <ul class="menu">
  
    
    <li class="menu-item menu-item-tech">
      <a href="/categories/tech/" title="提高姿势水平" rel="section">
      技术
      </a>
    </li>
  
    
    <li class="menu-item menu-item-archive">
      <a href="/archives/" title="总览历史文章" rel="section">
      归档
      </a>
    </li>
  
    
    <li class="menu-item menu-item-kaomoji">
      <a href="javascript:void;" title="点我点我" rel="section">
      (´・ω・`)
      </a>
    </li>
  
</ul>

    </div>
  </div>
  <div class="left clf"></div>

</div>

      </div>

      <div id="container" class="wc center clf page-post">
        <script type="text/javascript">nanobar.go(20);</script>

        <div id="content" class="wp">
          

  
  <article class="post post-type-normal hentry">
    <h1 class="post-title">
      <a href="/install-fail2ban-to-ban-ips-that-make-too-many-authentication-failures/">安装 fail2ban 防止 SSH 暴力破解</a>
    </h1>

    


  <div class="alert alert-warning expired-message">
    <p>本文最后更新于 957 天前（2015-08-28），其中的信息可能已经有所发展或是发生改变。</p>
  </div>



  <div class="alert alert-danger expired-message">
    <p>请注意，本文最后更新于 957 天前，文中信息极有可能已经过期且不再适用于现阶段。</p>
  </div>



    <div class="post-content">
      <p>窝一直天真的以为不会有人暴力破解窝的，直到今天看了一下 <code>grep sshd /var/log/auth.log</code> 。。</p>
<p><img src="https://img.blessing.studio/images/2015/08/2015-08-15_12-49-38.png" alt="log"></p>
<p>防止 ssh 暴力破解大概就是使用 ssh key，改端口，关闭口令登录，还有就是 fail2ban，denyhost 之类的软件了，这里窝打算使用 fail2ban。项目地址：<a href="https://github.com/fail2ban/fail2ban" target="_blank" rel="noopener">GitHub</a>，官网：<a href="http://www.fail2ban.org/" target="_blank" rel="noopener">http://www.fail2ban.org/</a></p>
<pre><code>__      _ _ ___ _               
/ _|__ _(_) |_  ) |__  __ _ _ _  
|  _/ _` | | |/ /| &#39;_ \/ _` | &#39; \
|_| \__,_|_|_/___|_.__/\__,_|_||_|
v0.9.3.dev              2015/XX/XX
</code></pre><blockquote>
<p>简介：Fail2Ban scans log files like /var/log/pwdfail and bans IP that makes too many password failures. It updates firewall rules to reject the IP address. These rules can be defined by the user. Fail2Ban can read multiple log files such as sshd or Apache web server ones.</p>
</blockquote>
<h3 id="1-安装"><a href="#1-安装" class="headerlink" title="1. 安装"></a>1. 安装</h3><p>安装可以源码编译安装也可以直接包管理器安装，Ubuntu 软件仓库中已经添加了 fail2ban，直接 apt-get 即可。源码编译安装请参照官方项目 README。</p>
<pre><code>$ sudo apt-get update
$ sudo apt-get install fail2ban
</code></pre><h3 id="2-基本配置"><a href="#2-基本配置" class="headerlink" title="2. 基本配置"></a>2. 基本配置</h3><p>安装完成后 fail2ban 的配置文件可以在 <code>/etc/fail2ban/</code> 中找到，其中：</p>
<pre><code>/etc/fail2ban/fail2ban.conf  #fail2ban 的配置文件
/etc/fail2ban/jail.conf  #一个 filter 或者多个 action 的组合，阻挡设定文件
/etc/fail2ban/filter.d/  #过滤器，具体过滤规则文件目录
/etc/fail2ban/action.d/  #操作，检测到后采取相对应措施的目录
</code></pre><p>fail2ban 中已经内置常用软件的过滤规则，如 ssh，ftp 等，在 <code>/etc/fail2ban/jail.conf</code> 中配置为 enable 即可</p>
<p><img src="https://img.blessing.studio/images/2015/08/2015-08-15_13-19-37.png" alt="jail"></p>
<p>另外如果需要自定义 filter 的话需要正则表达式知识，这里就不多说了，自带的对于防范 ssh 暴力破解已经够用了</p>
<pre><code>启动|关闭|状态|重启 fail2ban： `service fail2ban {start|stop|status|restart}`
</code></pre><p>下面讲一下如何对 fail2ban 的默认配置进行调整</p>
<h3 id="3-进阶配置"><a href="#3-进阶配置" class="headerlink" title="3. 进阶配置"></a>3. 进阶配置</h3><p>首先，将默认配置 <code>/etc/fail2ban/jail.conf</code> 拷贝一份为 <code>jail.local</code></p>
<p>注意，<code>*.local</code> 中的配置会覆盖掉 <code>*.conf</code> 中的配置</p>
<pre><code class="shell">sudo cp /etc/fail2ban/jail.conf /etc/fail2ban/jail.local
</code></pre>
<p>编辑它</p>
<pre><code>sudo vim /etc/fail2ban/jail.local

In this file, there are a few settings you may wish to adjust. The settings located under the [DEFAULT] section will be applied to all services enabled for fail2ban that are not overridden in the service’s own section.

ignoreip = 127.0.0.1/8

You can adjust the source addresses that fail2ban ignores by adding a value to the ignoreip parameter. Currently, it is configured not ban any traffic coming from the local machine. You can add additional addresses to ignore by appending them to the end of the parameter, separated by a space.

bantime = 600

The bantime parameter sets length of time that a client will be banned when they have failed to authenticate correctly. This is measured in seconds. By default, this is set to 600 seconds, or 10 minutes.

findtime = 600 maxretry = 3

The next two parameters that you want to pay attention to are findtime and maxretry. These work together to establish the conditions under which a client is found to be an illegitimate user that should be banned.

The maxretry variable sets the number of tries a client has to authenticate within a window of time defined by findtime, before being banned. With the default settings, the fail2ban service will ban a client that unsuccessfully attempts to log in 3 times within a 10 minute window.

destemail = root@localhost sendername = Fail2Ban mta = sendmail

Some other settings you may wish to are the destemail, sendername, and mta settings if you wish to configure email alerts. The destemail parameter sets the email address that should receive ban messages. The sendername sets the value of the “From” field in the email. The mta parameter configures what mail service will be used to send mail.

action = $(action_)s

This parameter configures the action that fail2ban takes when it wants to institute a ban. The value action_ is defined in the file shortly before this parameter. The default action is to simply configure the firewall to reject traffic from the offending host until the ban time elapses.

If you would like to configure email alerts, you can change the value from action_ to action_mw. If you want the email to include the relevant log lines, you can change it to action_mwl. Make sure you have the appropriate mail settings configured if you choose to use mail alerts.
</code></pre><h3 id="4-测试一下？"><a href="#4-测试一下？" class="headerlink" title="4. 测试一下？"></a>4. 测试一下？</h3><p>现在窝们的 fail2ban 已经配置好了，是时候作死一波了（反正重新拨号就换 IP 怕啥</p>
<p>根据 <code>/etc/fail2ban/jail.conf</code> 中 <code>ssh</code> 的配置，只要窝们登录失败六次错误就会被 ban 掉 IP，那么就让窝祭出 cmd 大法来 ssh 登录吧！</p>
<p><img src="https://img.blessing.studio/images/2015/08/2015-08-12_12-42-14.jpg" alt="em1"></p>
<p>测试结果明天更吧~</p>
<h3 id="5-参考资料"><a href="#5-参考资料" class="headerlink" title="5. 参考资料"></a>5. 参考资料</h3><p><a href="https://github.com/fail2ban/fail2ban/blob/master/README.md" target="_blank" rel="noopener">https://github.com/fail2ban/fail2ban/blob/master/README.md</a></p>
<p><a href="http://drops.wooyun.org/tips/3029" target="_blank" rel="noopener">http://drops.wooyun.org/tips/3029</a></p>
<p><a href="http://my.oschina.net/lijialong/blog/109497" target="_blank" rel="noopener">http://my.oschina.net/lijialong/blog/109497</a></p>
<p><a href="https://www.digitalocean.com/community/tutorials/how-to-protect-ssh-with-fail2ban-on-ubuntu-14-04?utm_medium=community&amp;utm_source=newsletter&amp;utm_campaign=8272015" target="_blank" rel="noopener">https://www.digitalocean.com/community/tutorials/how-to-protect-ssh-with-fail2ban-on-ubuntu-14-04?utm_medium=community&amp;utm_source=newsletter&amp;utm_campaign=8272015</a></p>
<h3 id="6-UPDATE-LOG："><a href="#6-UPDATE-LOG：" class="headerlink" title="6. UPDATE LOG："></a>6. UPDATE LOG：</h3><p>8.28 使用分页和 bootstrap 对教程重新排版；添加了一些内容</p>

      <div class="post-about"><p>除另有声明外，本博客文章均采用 <a href="http://creativecommons.org/licenses/by-nc-sa/3.0/cn/">知识共享(Creative Commons) 署名-非商业性使用-相同方式共享 3.0 中国大陆许可协议</a> 进行许可。</p></div>
    </div>

    <div class="post-meta clf">
  <span class="pmt pms fa-book">
    
      <a class="category-link" href="/categories/tech/">技术</a>
    
  </span>
  <span class="pmt pms fa-clock-o">2015-08-16</span>
  <span class="pmt pms fa-eye">
    <span id="post-view" data="install-fail2ban-to-ban-ips-that-make-too-many-authentication-failures/">Loading</span> Hits
  </span>
  <span class="pmt pms extra fa-tag">
    
      <a class="tag-link" href="/tag/运维/">运维</a>
    
  </span>
</div>

  </article>

  
    <div class="disqus"></div>

<p class="disqus-notice hentry"  style="display: none;">
  <i class="fa fa-spinner fa-spin" aria-hidden="true"></i>  如果评论框加载不出来，那就说明 Disqus 被墙了，你看着办吧 |ー` )
</p>

  

        </div>

        <div id="sidebar" class="fl">

  <div id="abovesb">
    <div class="card">
      <div class="gr center">
        <p id="music-toggle">
          <i class="fa fa-play-circle" aria-hidden="true"></i>
        </p>
        <img src="/images/avatar.jpg" width="112" height="112">
      </div>

      <div class="blogname">Blessing Studio</div>
      <div class="blogdesc">半吊子全栈开发者的日常</div>

      <div class="sbmenu">
        <div class="menu-container">
          <ul class="menu">
  
    
    <li class="menu-item menu-item-popular">
      <a href="/popular-posts" title="(=ﾟωﾟ)=" rel="section">
        <i class="fa fa-star"></i>最受欢迎的文章
      </a>
    </li>
  
    
    <li class="menu-item menu-item-friends">
      <a href="/friends" title="友情链接" rel="section">
        <i class="fa fa-link"></i>我的小伙伴们
      </a>
    </li>
  
    
    <li class="menu-item menu-item-about">
      <a href="/about" title="(*ﾟ∀ﾟ*)" rel="section">
        <i class="fa fa-code"></i>关于我
      </a>
    </li>
  
</ul>

        </div>
      </div>
    </div>
    
    <div id="music-player" class="aplayer hide rotated"></div>
  </div>

  <script type="text/javascript">nanobar.go(40);</script>

  <div id="sb">
    
<div id="sbpin">
  
  <div class="clf widget-item widget_text">
    <div class="textwidget">
      <script type="text/javascript" src="https://work.prinzeugen.net/hitokoto/hitokoto.php?encode=javascript"></script>
      <p id="hitokoto"><script>hitokoto();</script></p>
    </div>
  </div>

  
  <div class="clf widget-item widget_text">
    <div class="textwidget">
      <div class="like-widget">
        <p class="like-title">Do you like me ?</p>
        <div style="margin: -3px 0 -2px;">
          <a class="like-vote">
            <i id="heart" class="fa fa-heart-o"></i> <span id="count"><span>
          </a>
        </div>
      </div>
    </div>
  </div>

</div>

  </div>

</div>

      </div><!-- #container -->

      <div id="foot" class="fw">
        <div id="bottom" class="fw">
  <div id="footer" class="wc center clf">
    <div class="info">
      <p>Copyleft 2018 <a href="https://blessing.studio">Blessing Studio</a>. Proudly published with <a href="https://hexo.io/" target="_blank">Hexo</a>. Made with ❤ by printempw.</p>
    </div>
  </div>
</div>

      </div>

    </div><!-- #pageframe.fw -->
    <script type="text/javascript">nanobar.go(80);</script>

    <div class="back-to-top">
      <span class="fa fa-angle-up"></span>
    </div>

    <script src="/js/jquery-2.2.0.min.js"></script>
<script src="/js/jquery.libs.js"></script>
<script src="/js/highlight.min.js"></script>
<script src="/libs/fancybox/source/jquery.fancybox.pack.js"></script>
<script src="/js/script.js"></script>

    
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-65656002-1', 'auto');
  ga('send', 'pageview');

</script>


    <script type="text/javascript">
    $("a.like-vote").mouseover(function() {
        $("#heart").removeClass("fa-heart-o");
        $("#heart").addClass("fa-heart");
    });

    $("a.like-vote").mouseout(function() {
        $("#heart").removeClass("fa-heart");
        $("#heart").addClass("fa-heart-o");
    });

    $.getJSON("//work.prinzeugen.net/do-you-like-me/like.php?action=get", function (data) {
        $('#count').html(data.like);
    });

    $('.like-vote').click(function () {
        if ($('.like-title').html() === 'Do you like me ?') {
            $.getJSON("//work.prinzeugen.net/do-you-like-me/like.php?action=add", function (data) {
                if (data.success) {
                    $('#count').fadeOut(200);
                    $('#count').html(String(parseInt(data.like)));
                    $('#count').fadeIn(200);
                    $('.like-title').html('我也喜欢你 (*≧▽≦)');
                }
                else {
                    $('.like-title').html('你的爱我已经感受到了~');
                }
            });
        }
    });
</script>

    <style type="text/css">
    .menu-item-kaomoji a {
        -moz-user-select: none;
        -webkit-user-select: none;
        -ms-user-select: none;
    }

    .info-rise {
        z-index: 99999;
        position: absolute;
        padding: 0 4px;
        border-radius: 1px;
        background-color: #f69;
        box-shadow: 0 0 1px rgba(0,0,0,0.1);
        color: #fff;
        text-align: center;
        font-size: 12px;
        line-height: 1.5;
        cursor: default
    }
</style>

<script type="text/javascript">
    var kaomoji_array = ["|∀ﾟ", "(´ﾟДﾟ`)", "(;´Д`)", "(｀･ω･)", "(=ﾟωﾟ)=", "| ω・´)", "|-` )", "|д` )", "|ー` )", "|∀` )", "(つд⊂)", "(ﾟДﾟ≡ﾟДﾟ)", "(＾o＾)ﾉ", "(|||ﾟДﾟ)", "( ﾟ∀ﾟ)", "( ´∀`)", "(*´∀`)", "(*ﾟ∇ﾟ)", "(*ﾟーﾟ)", "(　ﾟ 3ﾟ)", "( ´ー`)", "( ・_ゝ・)", "( ´_ゝ`)", "(*´д`)", "(・ー・)", "(・∀・)", "(ゝ∀･)", "(〃∀〃)", "(*ﾟ∀ﾟ*)", "( ﾟ∀。)", "( `д´)", "(`ε´ )", "(`ヮ´ )", "σ`∀´)", " ﾟ∀ﾟ)σ", "ﾟ ∀ﾟ)ノ", "(╬ﾟдﾟ)", "(|||ﾟдﾟ)", "( ﾟдﾟ)", "Σ( ﾟдﾟ)", "( ;ﾟдﾟ)", "( ;´д`)", "(　д ) ﾟ ﾟ", "( ☉д⊙)", "(((　ﾟдﾟ)))", "( ` ・´)", "( ´д`)", "( -д-)", "(>д<)", "･ﾟ( ﾉд`ﾟ)", "( TдT)", "(￣∇￣)", "(￣3￣)", "(￣ｰ￣)", "(￣ . ￣)", "(￣皿￣)", "(￣艸￣)", "(￣︿￣)", "(￣︶￣)", "ヾ(´ωﾟ｀)", "(*´ω`*)", "(・ω・)", "( ´・ω)", "(｀・ω)", "(´・ω・`)", "(`・ω・´)", "( `_っ´)", "( `ー´)", "( ´_っ`)", "( ´ρ`)", "( ﾟωﾟ)", "(oﾟωﾟo)", "(　^ω^)", "(｡◕∀◕｡)", "/( ◕‿‿◕ )\\", "ヾ(´ε`ヾ)", "(ノﾟ∀ﾟ)ノ", "(σﾟдﾟ)σ", "(σﾟ∀ﾟ)σ", "|дﾟ )", "┃電柱┃", "ﾟ(つд`ﾟ)", "ﾟÅﾟ )　", "⊂彡☆))д`)", "⊂彡☆))д´)", "⊂彡☆))∀`)", "(´∀((☆ミつ"];
    var hits = 0;
    var start_time = 0;

    $('.menu-item-kaomoji a').click(function(e) {

        if (start_time == 0) start_time = Date.now();

        hits ++;

        if (hits % 5 === 0) {
            index = Math.floor(Math.random() * kaomoji_array.length);
            $(this).html(kaomoji_array[index]);
        }

        x = $(this).offset().left + $(this).width();
        y = $(this).offset().top + $(this).height();

        if (hits % 50 === 0) {
            var duration = 2000;
            // actions per minite
            var apm = parseInt(hits / ((Date.now() - start_time) / 1000) * 60);
            start_time = 0;
            hits = 0;
            hit = $('<span class="info-rise" style="border: 1px solid #ffd6e4;font-size:13.5px;z-index:9999999;">手速：'+apm+' actions/min </span>');

            console.log('APM: '+apm);
        } else {
            var duration = 500;
            hit = $('<span class="info-rise">+1</span>');
        }

        hit.appendTo($("body"));

        hit.css({
            opacity: 0,
            left: x,
            top: y
        }).animate({
            opacity: 1,
            top: y - 16
        }, 250).animate({
            opacity: 1,
            top: y - 20
        }, duration).animate({
            top: y - 20
        }, duration).animate({
            opacity: 0,
            top: y - 32
        }, 250, function() {
            return $(this).remove();
        });

    });
</script>

    <style type="text/css">
    .p-load-gist {
        margin: 25px 0 25px !important;
        text-align: center;
    }
</style>

<script type="text/javascript">
    $('.load-gist').on('click', function() {
        var gist = {
            url: '//work.prinzeugen.net/gist/printempw/' + $(this).data('hash') + '.json?callback=?',
            dom: this
        };

        $.getJSON(gist.url, function(data) {
            gist.style      = document.createElement('link');
            gist.style.type = 'text/css';
            gist.style.rel  = 'stylesheet';
            gist.style.href = data.stylesheet;

            document.getElementsByTagName('HEAD')[0].appendChild(gist.style);

            $(gist.dom).after(data.div).remove();
        });
    });
</script>

    <script type="text/javascript">
    String.prototype.cleanSlug = function () {
        var search = '/index.html';

        if (this.indexOf(search) === -1) {
            return this.slice(0, -1)
        } else {
            return this.replace(search, '');
        }
    }

    var Counter = function (url) {
        this.baseCounterUrl = url;

        this.initAllPostViews = function () {
            var self = this;

            // 遍历 post-view
            $('[id=post-view]').each(function () {
                // 默认 PV 设为 0
                var span = $(this).html(0);
                var slug = span.attr('data').cleanSlug();

                self.getPostViewBySlug(slug, function (pv) {
                    span.html(pv);
                })
            });
        }

        this.getPostViewBySlug = function (slug, callback) {
            var url = this.baseCounterUrl + '/get/' + slug;

            $.getJSON(url, function (data) {
                callback(data.pv);
            });
        }

        this.incPostViewBySlug = function (slug) {
            var url = this.baseCounterUrl + '/increase/' + slug;

            $.post(url, {}, function (data) {
                $('#post-view').html(data.pv);
            });
        }
    }

    var counter = new Counter('https://work.prinzeugen.net/hexo-view-counter');

    $(document).ready(function () {
        counter.initAllPostViews();
    });
</script>


<script type="text/javascript">
    counter.incPostViewBySlug(
        $('#post-view').attr('data').cleanSlug()
    );
</script>


    <script src="/js/APlayer.min.js"></script>
<script type="text/javascript">
    var player = undefined;

    $.getJSON('https://work.prinzeugen.net/music/play_list.json', function (json) {
        // APlayer.addMusic sucks
        // And APlayer does not provide any method to remove
        // the automatically added music [undefined]
        player = new APlayer({
            element: document.getElementById('music-player'),
            narrow: false,
            autoplay: false,
            showlrc: false,
            mutex: true,
            preload: 'none',
            theme: '#367FA9',
            music: json
        });

        console.log('Music player initialized', json);
    });

    $('#music-toggle').click(function () {
        if (player === undefined) {
            return;
        }

        $('.card').addClass('rotated').addClass('hide');

        // I don't know why APlayer 1.6.0 tends to
        // attach "height: 0px" style to .aplayer-list automatically
        $('.aplayer-list').removeAttr('style')

        $('#music-player').removeClass('hide');

        $('#abovesb').css('padding', 0);

        setTimeout(function () {
            $('#music-player').removeClass('rotated');
        }, 10);
    });

    $('body').on('click', '.aplayer-icon-menu', function () {
        $('.aplayer-list').removeClass('aplayer-list-hide');

        $('#music-player').addClass('rotated').addClass('hide');

        $('.card').removeClass('hide');

        setTimeout(function () {
            $('.card').removeClass('rotated');
        }, 10);

        $('#abovesb').css('padding', '7px 0 1px');
    });
</script>


    
  <script src="/js/jquery.disqusloader.js"></script>

<script type="text/javascript">
  $.disqusLoader('.disqus', {
    scriptUrl: '//blessing-studio.disqus.com/embed.js',
    laziness: 0,
    preLoadCallback: function () {
        $('.disqus-notice').show()
    },
    disqusConfig: function () {
      this.callbacks.onReady = [function () {
        $('.disqus-notice').hide()
      }];
    }
  });
</script>



    <script type="text/javascript">nanobar.go(100);</script>
  </body>
</html>
